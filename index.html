<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App - Easy Tutorials</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
    <h1> I LOVE MEGHA </h1>

    <!-- Search -->
    <div class="search">
        <input type="text" placeholder="enter city / state / village" spellcheck="false">
        <button>
            <img src="search.png" alt="search">
        </button>
    </div>

    <!-- Weather -->
    <div class="weather">
        <img src="clear.png" class="weather-icon">

        <h1 class="temp">--°C</h1>
        <h2 class="city">Location</h2>

        <div class="details">
            <div class="col">
                <img src="humidity.png">
                <div>
                    <p class="humidity">--%</p>
                    <p>Humidity</p>
                </div>
            </div>

            <div class="col">
                <img src="wind.png">
                <div>
                    <p class="wind">-- km/h</p>
                    <p>Wind Speed</p>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const apiKey = "4408c9f7e44f5979dae8066620f649dd";

    const searchBox = document.querySelector(".search input");
    const searchBtn = document.querySelector(".search button");
    const weatherIcon = document.querySelector(".weather-icon");

    async function checkWeather(query) {

        /* STEP 1: GEOCODING API */
        const geoRes = await fetch(
            `https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=1&appid=${apiKey}`
        );
        const geoData = await geoRes.json();

        if (geoData.length === 0) {
            alert("Location not found");
            return;
        }

        const lat = geoData[0].lat;
        const lon = geoData[0].lon;

        /* STEP 2: WEATHER API (lat-lon based) */
        const weatherRes = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`
        );
        const data = await weatherRes.json();

        /* UI UPDATE */
        document.querySelector(".city").innerHTML =
            geoData[0].name +
            (geoData[0].state ? ", " + geoData[0].state : "") +
            (geoData[0].country ? ", " + geoData[0].country : "");

        document.querySelector(".temp").innerHTML =
            Math.round(data.main.temp) + "°C";

        document.querySelector(".humidity").innerHTML =
            data.main.humidity + "%";

        document.querySelector(".wind").innerHTML =
            data.wind.speed + " km/h";

        /* ICON CHANGE */
        const condition = data.weather[0].main;

        if (condition === "Clouds") {
            weatherIcon.src = "clouds.png";
        } else if (condition === "Clear") {
            weatherIcon.src = "clear.png";
        } else if (condition === "Rain") {
            weatherIcon.src = "rain.png";
        } else if (condition === "Drizzle") {
            weatherIcon.src = "drizzle.png";
        } else if (condition === "Mist") {
            weatherIcon.src = "mist.png";
        } else {
            weatherIcon.src = "clear.png";
        }
    }

    /* Search button click */
    searchBtn.addEventListener("click", () => {
        checkWeather(searchBox.value);
    });

    /* Enter key support */
    searchBox.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
            checkWeather(searchBox.value);
        }
    });

    /* Default load */
    checkWeather("Delhi");
</script>

</body>
</html>

